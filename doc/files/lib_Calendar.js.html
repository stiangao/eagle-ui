<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib/Calendar.js - eagle-ui</title>
  
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>
<body class="yui3-smart">
 <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
               <a class="navbar-brand mainlogo" href="">
             
            <img alt="eagle-ui" src="../assets/css/logo.png" title="eagle-ui">
            
                eagle-ui
          </a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                 <ul class="nav navbar-nav">
                    
                    <li><a href="">主页</a>
                    </li>
                    
                </ul>
               <div class="navbar-form navbar-right filterAPi" autocomplete="off">
                <input type="text" id='txtSearchAPI' class="form-control search-query" placeholder="Search for API" />
                 <ul id="filterList" class="filterItems dropdown-menu" role="menu"></ul>
                </div>
            </div>
        </div>
    </nav>
    <div id="sidebar">
    <h3>Modules/Classes</h3>
        <div id="api-tabview-filter">
            <input id='txtSearch' type="search" class="form-control" placeholder="Type to filter Modules/Classes">
        </div>
        <dl id="sidebar_list">
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/form.html">form</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/RadioGroup.html">RadioGroup</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Button.html">Button</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/ButtonGroup.html">ButtonGroup</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/grid.html">grid</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/Row.html">Row</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Col.html">Col</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/crumb.html">crumb</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/dialog.html">dialog</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Grid.html">Grid</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Select.html">Select</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Tab.html">Tab</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/toast.html">toast</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/ui.html">ui</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/Calendar.html">Calendar</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Label.html">Label</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Panel.html">Panel</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/PanelContent.html">PanelContent</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/PanelFooter.html">PanelFooter</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/PanelHeader.html">PanelHeader</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Table.html">Table</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Paging.html">Paging</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/CalendarPanel.html">CalendarPanel</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/LabelGroup.html">LabelGroup</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
        </dl>
</div>
   
    <div class="stdoc-content">
        <!--     <form id="options-form" class="form-inline pull-right">
        Show:
        <label for="api-show-inherited" class="checkbox">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected" class="checkbox">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private" class="checkbox">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated" class="checkbox">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </form>

 -->
        <div class="apidocs">
            <div id="docs-main">
                <div class="content">
                    <div class="page-header">
    <h1>lib/Calendar.js <small>File</small></h1>
</div>

<div class="file">
    <pre class="prettyprint linenums" id='src_code'>
import React,{ PropTypes, Component } from &#x27;react&#x27;;
import classnames from &#x27;classnames&#x27;;
import ClassNameMixin from &#x27;./utils/ClassNameMixin.js&#x27;;

/**
 * 日历组件&lt;br /&gt;
 * 需要和CalendarPanel组合使用
 * @class Calendar
 * @module ui
 * @extends Component
 * @constructor
 * @since 0.1.0
 * @demo src/calendar.js {js}
 * @demo calendar.html {html}
 * @show true
 * */
@ClassNameMixin
export default class Calendar extends Component{

    static propTypes = {
        /**
         * 样式类名前缀
         * @property classPrefix
         * @type String
         * @default calendar
         * */
        classPrefix:PropTypes.string,
        /**
         * 起始日期
         * @property startDate
         * @type String
         * @default empty
         * */
        startDate:PropTypes.string,
        /**
         * 终止日期
         * @property endDate
         * @type String
         * @default empty
         * */
        endDate:PropTypes.string,
        /**
         * 默认选中日期
         * @property defaultDate
         * @type String
         * @default 当天
         * */
        defaultDate:PropTypes.string,
        /**
         * 日期格式
         * @property format
         * @type string
         * @default &#x27;yyyy-MM-dd&#x27;
         * */
        format:PropTypes.string,
        /**
         * 选择某个具体日期后执行的回调函数
         * @property selectCallback
         * @type Function
         * @default empty
         * */
        selectCallback:PropTypes.func
    };

    static defaultProps = {
        format:&#x27;yyyy-MM-dd&#x27;,
        classPrefix:&#x27;calendar&#x27;
    };

    constructor(props, context) {
        super(props, context);

        this.today = new Date();

        this.month = [1,2,3,4,5,6,7,8,9,10,11,12];

        this.windowType = [&#x27;getCalendar&#x27;,&#x27;getMonths&#x27;,&#x27;getYears&#x27;];

        let defaultDate = this.props.defaultDate || new Date();
        this.state = {
            currentDate:defaultDate,
            selectedDate:defaultDate,
            show:false,
            year:typeof(defaultDate)!=&#x27;string&#x27;?defaultDate.getFullYear():new Date(defaultDate).getFullYear(),
            windowType:this.windowType[!isNaN(this.props.windowType) ?this.props.windowType :0]
        };
    }

    getCurrentDate(){
        let {currentDate} = this.state;
        return typeof(currentDate)!=&#x27;string&#x27; ? currentDate : new Date(currentDate);
    }

    getSelectedDate(){
        let {selectedDate} = this.state;
        return typeof(selectedDate)!=&#x27;string&#x27; ? selectedDate : new Date(selectedDate);
    }

    dateClick(date){
        let d= date.split(&#x27;/&#x27;),
            {selectCallback} = this.props;
        //console.dir(this.getDate(d[0],d[1],d[2]));
        selectCallback &amp;&amp; selectCallback(this.getDate(d[0],d[1],d[2]),d );
        this.setState({
            currentDate:new Date(date)
        });
        this.props.closeCallback &amp;&amp;(this.props.closeCallback() );
    }

    getDates(arr,selectedDate,defaultDate){
        let d,dom = [],
            _this = this,
            month = selectedDate.getMonth(),
            year = selectedDate.getFullYear();

        let {startDate,endDate} = this.props;
        //startDate=&#x27;2015/11/16&#x27;;
        //endDate=&#x27;2015/11/20&#x27;;
        for(let j=1;j&lt;=7;j++){

            if(arr.length &gt; 0){
                d = arr.shift();
                let disabled = ((startDate &amp;&amp; new Date(year, month, d).getTime() &lt;= new Date(startDate).getTime() ) || (endDate &amp;&amp; new Date(year, month, d).getTime() &gt;= new Date(endDate).getTime() ) );
                //&quot;eg-active&quot; eg-calendar-selected
                dom.push(&lt;td&gt;&lt;span className={
                    classnames(this.getClassName(&#x27;item&#x27;),{
                        [this.getClassName(&#x27;active&#x27;,false)]:this.isToday(year,month+1,d ),
                        [this.getClassName(&#x27;disabled&#x27;)]:disabled,
                        &#x27;no-hover&#x27;:d==&#x27; &#x27;,
                        [this.getClassName(&#x27;selected&#x27;)]:(this.isOptionSelect(selectedDate,defaultDate) &amp;&amp; defaultDate.getDate()==d &amp;&amp;!disabled )
                    })
                } onClick={disabled ||d==&#x27; &#x27;? &#x27;&#x27;:_this.dateClick.bind(_this,&#x60;${year}/${month+1}/${d}&#x60;)} &gt;{d}&lt;/span&gt;&lt;/td&gt; );
            }
        }
        return dom;
    }

    isOptionSelect(current,selectDate){
        return current.getFullYear() == selectDate.getFullYear() &amp;&amp; current.getMonth() == selectDate.getMonth();
    }
    /**废弃*/
    onChange(e){
        let target = e.target;
        this.setState({
            selectedDate:target.value
        });
    }
    /**废弃*/
    drawSelect(){
        let select = [],
            monthList = this.month,
            //date = this.state.selectedDate,
            selectedDate = this.getSelectedDate(),
            date = selectedDate,
            years = [],
            _this = this,
            year = date.getFullYear();

        years = [new Date(year-1,1,1).getFullYear(),year,new Date(year+1,1,1).getFullYear() ];

        let option = function(){
            return (
                years.map((year)=&gt;{
                    return monthList.map((month)=&gt;{
                        return &lt;option value={&#x60;${year}/${month}/1&#x60;}&gt;{year}年{_this.getDay(month)}月&lt;/option&gt;
                    })
                })
            )

        };
        select.push(
            &lt;select
                className=&quot;options&quot;
                onChange={::this.onChange}
                defaultValue={this.defaultSelectDate=selectedDate.getFullYear()+&#x27;/&#x27;+(selectedDate.getMonth()+1)+&#x27;/&#x27;+&#x27;1&#x27;}&gt;
                {option()}
            &lt;/select&gt;
        );
        return select;
    }

    draw(){
        let
            selectedDate = this.getSelectedDate(),
            defaultDate = this.getCurrentDate(),
            month = selectedDate.getMonth(),
            year = selectedDate.getFullYear(),
            arr = [];

        for(let i =1,firstDay = new Date(year,month,1).getDay();i&lt;= firstDay;i++){
            arr.push(&#x27; &#x27;);
        }
        for(let i=1,monthDay = new Date(year,month+1,0).getDate();i&lt;=monthDay;i++ ){
            arr.push(i);
        }

        let d,dom = [];
        while(arr.length &gt; 0){
            dom.push(&lt;tr className=&quot;body&quot;&gt;
                {
                    this.getDates(arr,selectedDate,defaultDate )
                }
            &lt;/tr&gt;);


        }

        return dom;
    }

    isToday(year, month, date){
        var d = this.today;
        return d.getFullYear() == year &amp;&amp; (d.getMonth() + 1) == month &amp;&amp; d.getDate() == date;
    }

    getDate(year, month, date){
        let {format} = this.props;

        return format.replace(/y{4}/,year).replace(/M{1,2}/, month).replace(/d{1,2}/, date);
    }

    getDay(day){
        day*=1;
        return day&lt;=9 ? &#x60;0${day}&#x60; : day;
    }

    todayHandler(){
        this.setState({
            selectedDate:this.today,
            currentDate:this.today
        });
    }

    isParent (obj,parentObj){
        while (obj != undefined &amp;&amp; obj != null ){
            //&amp;&amp; obj.nodeType==1&amp;&amp; obj.tagName.toUpperCase() != &#x27;BODY&#x27;
            if (obj == parentObj){
                return true;
            }
            obj = obj.parentNode;
        }
        return false;
    }

    componentDidMount(){
        let _this = this;
        //let calendarContainer = ReactDOM.findDOMNode(this);
        /*document.addEventListener(&#x27;click&#x27;,function(e){
            if(_this.isParent(e.target,calendarContainer) ){
                console.dir(&#x27;parent&#x27;);
            }else{
                console.dir(&#x27;siquba&#x27;);
            }
        },false);*/
    }

    getMonth(month){
        return month+1;
    }

    getYears(){
        let year=this.switchYearForInterval(this.state.year),
            sYear = this.getSelectedDateSplit().year,
            _this=this;

        let years = (year)=&gt;{
            let y = year-1,
                list = [];
            for (let i = -1; i &lt; 11; i++) {
                list.push(
                    &lt;span&gt;&lt;i className={classnames({
                                    [_this.getClassName(&#x27;selected&#x27;,false)]:sYear == y,
                                    old:i == -1 || i == 10
                                })} onClick={_this.switchYear.bind(this,y)}&gt;{y}&lt;/i&gt;&lt;/span&gt;
                );
                y += 1;
            }
            return list;
        };

        return (

            &lt;table className=&quot;calendar&quot;&gt;
                &lt;thead className=&quot;eg-calendar-header&quot;&gt;
                &lt;th&gt;
                    &lt;div className={this.getClassName(&#x27;icon-prev&#x27;,false)} onClick={this.switchYearForInterval.bind(this,year-1,true)}&gt;&lt;/div&gt;
                &lt;/th&gt;
                &lt;th colSpan=&quot;5&quot;&gt;
                    &lt;div className=&quot;title&quot;&gt;{&#x60;${year}年-${year + 9}年&#x60;}&lt;/div&gt;
                &lt;/th&gt;
                &lt;th&gt;
                    &lt;div className={this.getClassName(&#x27;icon-next&#x27;,false)} onClick={this.switchYearForInterval.bind(this,year+10,true)}&gt;&lt;/div&gt;
                &lt;/th&gt;
                &lt;/thead&gt;
                &lt;tbody&gt;
                &lt;tr className=&quot;month-list&quot;&gt;
                    &lt;td colSpan=&quot;7&quot;&gt;
                        {years(year)}
                    &lt;/td&gt;

                &lt;/tr&gt;
                &lt;/tbody&gt;
            &lt;/table&gt;

        );
    }

    getMonths(){
        let selectDate = this.getSelectedDateSplit(),_this = this;

        return (

            &lt;table className=&quot;calendar&quot;&gt;
                &lt;thead className=&quot;eg-calendar-header&quot;&gt;
                &lt;th&gt;
                    &lt;div className={this.getClassName(&#x27;icon-prev&#x27;,false)} onClick={this.switchYear.bind(this,&#x27;-1&#x27;)}&gt;&lt;/div&gt;
                &lt;/th&gt;
                &lt;th colSpan=&quot;5&quot;&gt;
                    &lt;div className=&quot;title&quot; onClick={::this.switchWindow.bind(this,2)}&gt;{&#x60;${selectDate.year}年&#x60;}&lt;/div&gt;
                &lt;/th&gt;
                &lt;th&gt;
                    &lt;div className={this.getClassName(&#x27;icon-next&#x27;,false)} onClick={this.switchYear.bind(this,&#x27;+1&#x27;)}&gt;&lt;/div&gt;
                &lt;/th&gt;
                &lt;/thead&gt;
                &lt;tbody&gt;
                    &lt;tr className=&quot;month-list&quot;&gt;
                        &lt;td colSpan=&quot;7&quot;&gt;
                        {
                            this.month.map(function(item){
                                return &lt;span&gt;&lt;i className={classnames({
                                    [_this.getClassName(&#x27;selected&#x27;,false)]:selectDate.month == item
                                })} onClick={_this.switchMonth.bind(_this,item*1-1)}&gt;{item+&#x27;月&#x27;}&lt;/i&gt;&lt;/span&gt;;
                            })
                        }
                        &lt;/td&gt;

                    &lt;/tr&gt;
                &lt;/tbody&gt;
            &lt;/table&gt;

        );
    }

    getCalendar(){

        let selectDate = this.getSelectedDateSplit(),
            weeks=[&#x27;日&#x27;,&#x27;一&#x27;,&#x27;二&#x27;,&#x27;三&#x27;,&#x27;四&#x27;,&#x27;五&#x27;,&#x27;六&#x27;];

        return (

            &lt;table className=&quot;calendar&quot;&gt;
                &lt;thead className=&quot;eg-calendar-header&quot;&gt;
                &lt;th&gt;
                    &lt;div className={this.getClassName(&#x27;icon-prev&#x27;,false)} onClick={this.switchMonth.bind(this,&#x27;-1&#x27;)}&gt;&lt;/div&gt;
                &lt;/th&gt;
                &lt;th colSpan=&quot;5&quot;&gt;
                    &lt;div className=&quot;title&quot; onClick={::this.switchWindow.bind(this,1)}&gt;{&#x60;${selectDate.year}年${selectDate.month}月&#x60;}&lt;/div&gt;
                &lt;/th&gt;
                &lt;th&gt;
                    &lt;div className={this.getClassName(&#x27;icon-next&#x27;,false)}  onClick={this.switchMonth.bind(this,&#x27;+1&#x27;)}&gt;&lt;/div&gt;
                &lt;/th&gt;
                &lt;/thead&gt;
                &lt;tbody&gt;
                &lt;tr className=&quot;head&quot;&gt;
                    {
                        weeks.map(function(week){
                            return &lt;td&gt;{week}&lt;/td&gt;
                        })
                    }
                &lt;/tr&gt;

                {this.draw()}
                &lt;/tbody&gt;
            &lt;/table&gt;

        );
    }

    switchWindow(type){
        //this.setState({
        //    windowType:type
        //});
        this.props.setWindowType(type);
    }

    switchYearForInterval(ye=this.getSelectedDateSplit().year,t=false){
        let _this = this;

        //debugger;
        //let year = parseInt(ye / 10, 10) * 10;
        if(t){
            this.setState({
                year:ye
            });
        }else{
            return parseInt(ye / 10, 10) * 10;
        }

       // return year;
    }

    switchYear(type){
        let selected = this.getSelectedDate(),
            year = selected.getFullYear();

        this.setState({
            selectedDate:new Date(typeof(type)==&#x27;string&#x27;?year + eval(&quot;(&quot; + type + &quot;)&quot;):type,selected.getMonth(),1 )
        });
        typeof(type)!=&#x27;string&#x27; &amp;&amp;(this.switchWindow(1) );
    }

    switchMonth(type){
        let selected = this.getSelectedDate(),
            year = selected.getFullYear(),
            month = selected.getMonth();

        this.setState({
            selectedDate:new Date(year,typeof(type)==&#x27;string&#x27;?month + eval(&quot;(&quot; + type + &quot;)&quot;):type,1 )
        });
        typeof(type)!=&#x27;string&#x27; &amp;&amp;(this.switchWindow(0) );
    }

    getSelectedDateSplit(){
        let selectedDate = this.getSelectedDate();

        let year = selectedDate.getFullYear(),
            month = this.getMonth(selectedDate.getMonth() ),
            date = selectedDate.getDate();

        return {year,month,date};
    }


    render(){
        let {windowType}= this.props;

        windowType = this.windowType[windowType];
        //!isNaN(windowType) &amp;&amp;this.state.windowType==this.windowType[0] ?this.windowType[windowType] :this.state.windowType;
        return (
            &lt;div className={
                classnames(this.getClassName(&#x27;container&#x27;),this.getClassName(this.props.show?&#x27;show&#x27;:&#x27;hide&#x27;,false) )
            } &gt;
                &lt;div className=&quot;eg-calendar-box&quot;&gt;
                    &lt;div className=&quot;box&quot;&gt;

                        &lt;div className=&quot;eg-calendar-body&quot;&gt;
                            {this[windowType]()}

                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        );
    }
}
    </pre>
</div>

                </div>
            </div>
        </div>
    </div>
<a id="gotoTop" class='well well-small' href='#'>
    Top
</a>
<script src="../assets/vendor/jquery/jquery-1.8.2.min.js"></script>
<script src="../assets/vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script src="../assets/js/config.js"></script>
<script src="../assets/js/doc.js"></script>
</body>
</html>
