<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib/Select.js - eagle-ui</title>
  
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>
<body class="yui3-smart">
 <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
               <a class="navbar-brand mainlogo" href="">
             
            <img alt="eagle-ui" src="../assets/css/logo.png" title="eagle-ui">
            
                eagle-ui
          </a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                 <ul class="nav navbar-nav">
                    
                    <li><a href="">主页</a>
                    </li>
                    
                </ul>
               <div class="navbar-form navbar-right filterAPi" autocomplete="off">
                <input type="text" id='txtSearchAPI' class="form-control search-query" placeholder="Search for API" />
                 <ul id="filterList" class="filterItems dropdown-menu" role="menu"></ul>
                </div>
            </div>
        </div>
    </nav>
    <div id="sidebar">
    <h3>Modules/Classes</h3>
        <div id="api-tabview-filter">
            <input id='txtSearch' type="search" class="form-control" placeholder="Type to filter Modules/Classes">
        </div>
        <dl id="sidebar_list">
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/form.html">form</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/RadioGroup.html">RadioGroup</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Select.html">Select</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/ValidatorPanel.html">ValidatorPanel</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Button.html">Button</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/ButtonGroup.html">ButtonGroup</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/grid.html">grid</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/Grid.html">Grid</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Row.html">Row</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Col.html">Col</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/panel.html">panel</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/Panel.html">Panel</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/PanelContent.html">PanelContent</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/PanelFooter.html">PanelFooter</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/PanelHeader.html">PanelHeader</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/table.html">table</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/Table.html">Table</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Td.html">Td</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Th.html">Th</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Tr.html">Tr</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/ui.html">ui</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/crumb.html">crumb</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Item.html">Item</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Tab.html">Tab</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Calendar.html">Calendar</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/CalendarPanel.html">CalendarPanel</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/dialog.html">dialog</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Label.html">Label</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/LabelGroup.html">LabelGroup</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/List.html">List</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Paging.html">Paging</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Tabset.html">Tabset</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Toast.html">Toast</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
        </dl>
</div>
   
    <div class="stdoc-content">
        <!--     <form id="options-form" class="form-inline pull-right">
        Show:
        <label for="api-show-inherited" class="checkbox">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected" class="checkbox">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private" class="checkbox">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated" class="checkbox">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </form>

 -->
        <div class="apidocs">
            <div id="docs-main">
                <div class="content">
                    <div class="page-header">
    <h1>lib/Select.js <small>File</small></h1>
</div>

<div class="file">
    <pre class="prettyprint linenums" id='src_code'>
/**
 * Created by panqianjin on 15/11/12.
 */
import React, {Component, PropTypes} from &#x27;react&#x27;;
import ClassNameMixin from &#x27;./utils/ClassNameMixin&#x27;;
import classnames from &#x27;classnames&#x27;;
import Input from &#x27;./Input.js&#x27;;
import Row from &#x27;./Row.js&#x27;;
import Col from &#x27;./Col.js&#x27;;
import Grid from &#x27;./Grid.js&#x27;;
/**
 * 下拉选择框组件。
 * 因原先考虑不周，导致代码写得很乱，有待重构
 * @Class Select
 * @Module form
 * @extends Coponent
 * @since 0.1.0
 * @demo src/select.js{js}
 * @demo select.html{html}
 * @show true
 * */
@ClassNameMixin
export default
class Select extends Component {
    static defaultProps = {
        /**
         * 回调方法，主要作用将value传给父级元素。默认为null
         * @property callback
         * @type func
         * @default null
         * */
        callback: null,
        /**
         * 样式类名前缀
         * @property classPrefix
         * @type string
         *
         * */
        classPrefix: &#x27;select&#x27;,
        componentTag: &#x27;div&#x27;,
        value: &#x27;&#x27;,
        /**
         * option对应的value
         * @property key
         * &amp;type String
         * */
        key:&#x27;&#x27;,
        show: false,
        target: &#x27;0&#x27;,
        /**
         * 输入值，用来匹配显示对应列表的内容
         * @property autoVal
         * &amp;type String
         * */
        autoVal: &#x27;&#x27;
    }

    constructor(props, context) {
        super(props, context);
        this.state = {
            show: this.props.show,
            value:this.props.value,
            autoVal: this.props.autoVal,
            key:this.props.key
        };
    }
    /**
     * 第一次渲染完成后执行,为document添加点击监听事件，判断是否关闭ul
     * 生命周期方法
     * @method componentDidMount
     * */
    componentDidMount() {
        let _this = this;
        let selectContair = ReactDOM.findDOMNode(this.refs.selectContair);
        document.addEventListener(&#x27;click&#x27;, function (e) {
            if (_this.isParent(e.target, selectContair)) {
                //console.dir(&#x27;不要动&#x27;);
            } else {
                if(_this.state.show){
                    _this.hideUl();
                }
            }
        }, false);
    }
    /**
     * 判断obj是否为parentObj的子元素
     * @method isParent
     * @param obj {Object}
     * @param parentObj {Object}
     * @return {Boolean}
     * */
    isParent(obj, parentObj) {
        while (obj != undefined &amp;&amp; obj != null) {
            if (obj == parentObj) {
                return true;
            }
            obj = obj.parentNode;
        }
        return false;
    }
    /**
     * 显示选项列表,当ul关闭时才changestate
     * @method showUl
     * @return null
     * */
    showUl() {
        if(!this.state.show){
            this.setState({
                show: true
            })
        }
    }
    /**
     * 显示auto自动补充选项列表
     * @method showAutoUl
     * @param event {Object}
     * @return null
     * */
    showAutoUl(event){
        this.setState({
            value: event.target.value
        })
        if(!this.state.show){
            this.setState({
                show: true
            })
        }
        this.changeValue();
    }
    /**
     * 点击icon时，控制ul的显示与否
     * @method toogleUl
     * @return null
     * */
    toogleUl() {
        this.setState({
            show: !this.state.show
        })
    }
    /**
     * 取得符合要求的值，父级回调存在的话调用
     * @method callBacks
     * @return null
     * */
    callBacks() {
        this.getTrueVal();
        let val = this.state.value;
        if(this.state.show){
            this.setState({
                show: false
            })
        }
        console.log(ReactDOM.findDOMNode(this.refs.test).value);
        this.props.callback &amp;&amp; this.props.callback(val);
    }
    /**
     * 验证输入值是否为select内容，return true 否则return false
     * @method isInSelect
     * @return flags {Boolean}
     * */
    isInSelect(){
        let val = &#x27;^&#x27;+this.state.value+&#x27;$&#x27;;
        let reg = new RegExp(val,&quot;g&quot;);
        let flags = false;
        let li = React.Children.map(this.props.children,(item)=&gt;{
                if(reg.test(item.props.children)){
                   flags = true;
                }
                return item;
        },this);
        return flags;

    }
    /**
     * 改变input的value
     * @method handlerValue
     * @param event {Object}
     * @return null
     * */
    handlerValue(event){
        //console.log(event.target.value);
        let val = event.target.value;
        this.setState({
            value: val,
            autoVal: val
        })
        this.changeValue();
    }
    /**
     * 判断是否输入值为select范围内,否则改为第一个值。延时2s后点用callBacks方法
     * @method changeValue
     * @return null
     * */
    changeValue() {
        clearTimeout(this.timeout);
        this.timeout = setTimeout(::this.callBacks, 2000);
    }
    /**
     * 根据当前值是否为select内的值，判断是否改变state的值
     * @method getTrueVal
     * @return null
     * */
    getTrueVal(){
        if(!(::this.isInSelect())){
            this.setState({
                value:this.props.children[0].props.children,
                key: this.props.children[0].props.value
            });
        }
    }
    /**
     * 点击或者enter键时，选择当前li的值，并关闭ul
     * @method chooseItem
     * @param event {Object}
     * @return null
     * */
    chooseItem(event) {
        let ulChildren = ReactDOM.findDOMNode(this.refs.selectUl).children;
        let inputObj = ReactDOM.findDOMNode(this.refs.select);
        this.removeAllActive(ulChildren);
        event.target.classList.add(&#x27;active&#x27;);
        this.setState({
            show: !this.state.show,
            value: event.target.textContent,
            key: event.target.value
        })
        inputObj.focus();
        this.changeValue();
    }
    /**
     * 关闭ul，当前ul显示时起作用
     * @method hideUl
     * @return null
     * */
    hideUl() {
        if(this.state.show){
            this.setState({
                show: false
            })

        }
    }
    /**
     * target为flase移除li的active状态，否则将obj子元素的值付给state.value
     * @method removeAllActive
     * @param obj {Object}
     * @param target {Boolean}
     * @return null
     * */
    //@target: is changState
    removeAllActive(obj,target){
        Array.prototype.slice.call(obj).map((item,index)=&gt;{
            if(item.className.indexOf(&#x27;active&#x27;)&gt;-1){
            if(target){
                this.setState({
                    value: item.textContent
                });
            }else{
                item.classList.remove(&#x27;active&#x27;);
            }

            }
        });
    }
    /**
    * keydown时触发，不通方向键分别对应不同方法
    * @method keyIn
    * @param event {Object}
    * @return null
    * */
    keyIn(event){
        let selectUl = ReactDOM.findDOMNode(this.refs.selectUl);
        let ulChildren = ReactDOM.findDOMNode(this.refs.selectUl).children;
        let ulArrey = Array.prototype.slice.call(ulChildren);
        let i = -1;
        let obj = ulChildren[0];
        if(event.keyCode == 40 || event.keyCode == 38){
            /**
             * 当ul显示时，方向键移动起作用
             * 遍历寻找当前active元素的位置，并移除active
             * */
            if(this.state.show){
                ulArrey.map((item,index)=&gt;{
                    if(item.className.indexOf(&#x27;active&#x27;)&gt;-1){
                    i = index;
                    item.classList.remove(&#x27;active&#x27;);
                }
                });
                if(event.keyCode == 40){
                    /**
                     * 下方向键，判断active元素是否为最后一个，是则不再向下否则i+1
                     * */
                    obj = (i == ulChildren.length - 1)? ulChildren[i]:ulChildren[i+1];
                }else{
                    /**
                     * 上方向键，判断active元素是否为第一个，是则不再向上否则i－1
                     * */
                    obj = (i == 0)? ulChildren[i]:ulChildren[i-1];
                }
                obj.classList.add(&#x27;active&#x27;);
                /**
                 * 如果active为第五个元素之前的元素，则scrollTop不变，否则每向下一个，scrollTop加30
                 * */
                selectUl.scrollTop = i &lt; 4 ? 0 : (i-3)*30;
            }
        }else if(event.keyCode == 13){
            /**
             * enter键，取得当前元素值
             * */
            this.setState({
                show: false
            })
            this.removeAllActive(ulChildren,true);
            this.changeValue();
        }
    }
    /**
     * 为选中li元素增加active class
     * @method addActive
     * @param event {Object}
     * @return null
     * */
    addActive(event){
        let obj = event.target;
        let ulChildren = ReactDOM.findDOMNode(this.refs.selectUl).children;
        this.removeAllActive(ulChildren,false);
        obj.classList.add(&#x27;active&#x27;);
    }
    /**
     * 为li元素移除active class
     * @method removeActive
     * @param event {Object}
     * @return null
     * */
    removeActive(event){
        let obj = event.target;
        if(this.state.show){
            obj.classList.remove(&#x27;active&#x27;);
        }

    }
    /**
     * 渲染li元素，并根据autoVal来匹配获得符合元素
     * this.state.autoVal 为input输入值，初始为.*匹配任意
     * @method renderLi
     * @return li {ReactElement}
     * */
    renderLi(){
        let autoVal = this.state.autoVal == &#x27;&#x27;? &#x27;.*&#x27;: this.state.autoVal;
        let reg = new RegExp(autoVal,&quot;g&quot;);
        let li =React.Children.map(this.props.children,(item)=&gt;{
            if(reg.test(item.props.children)){
               return &lt;li value={item.props.value}  onMouseOver={::this.addActive} onMouseOut={::this.removeActive} onClick={::this.chooseItem}&gt;{item.props.children}&lt;/li&gt;
            }

        },this);

        return li;
    }
    renderOption(){
        let option = React.Children.map(this.props.children,(item)=&gt;{
            return &lt;option value={item.props.value}&gt;{item.props.children}&lt;/option&gt;
        },this);
        return option;
    }
    /**
     * 渲染select
     * @method renderSelect
     * @return {ReactElement}
     * */
    renderSelect() {
        return (
            &lt;Grid ref=&#x27;selectContair&#x27; className={
                    classnames(
                        this.getClassNamesForArguments(&#x27;container&#x27;)
                    )
                } value={this.state.value}&gt;
                &lt;select ref=&#x27;test&#x27; value={this.state.key} style={{display:&#x27;none&#x27;}}&gt;
                    {this.renderOption()}
                &lt;/select&gt;
                &lt;Input ref=&#x27;select&#x27; value={this.state.value}  onClick={::this.showUl} onChange={::this.handlerValue} onKeyDown={::this.keyIn}/&gt;
                &lt;i className={
                    classnames(
                        this.getClassName(&#x27;arrow-up&#x27;)
                    )
                } onClick={::this.toogleUl}&gt;&lt;/i&gt;
                &lt;i className={
                    classnames(
                        this.getClassName(&#x27;arrow-down&#x27;)
                    )
                } onClick={::this.toogleUl}&gt;&lt;/i&gt;
                &lt;ul ref=&#x27;selectUl&#x27; className={classnames(
                    this.getClassNamesForArguments(&#x27;ul&#x27;),
                    {
                        [this.getClassName(&#x27;show&#x27;)]: this.state.show
                    })
                }&gt;
                    {this.renderLi()}
                &lt;/ul&gt;
            &lt;/Grid&gt;
        )
    }
    /**
     * 渲染自动补全的输入框
     * @method renderAuto
     * @return {ReactElement}
     * */
    renderAuto() {
        return (
            &lt;Grid ref=&#x27;selectContair&#x27; className={
                    classnames(
                        this.getClassNamesForArguments(&#x27;container&#x27;)
                    )
                }&gt;
                &lt;Input ref=&#x27;select&#x27; value={this.state.value}  onChange={::this.showAutoUl} onKeyDown={::this.keyIn}/&gt;
                &lt;ul ref=&#x27;selectUl&#x27; className={classnames(
                    this.getClassNamesForArguments(&#x27;ul&#x27;),
                    {
                        [this.getClassName(&#x27;show&#x27;)]: this.state.show
                    })
                }&gt;
                    {this.renderLi()}
                &lt;/ul&gt;
            &lt;/Grid&gt;
        )
    }
    /**
     * 根据auto存在与否渲染不同类型的元素
     * @method render
     * @return {ReactElement}
     * */
    render() {
        return (
            this.props.auto ? this.renderAuto() : this.renderSelect()
        );
    }
}
    </pre>
</div>

                </div>
            </div>
        </div>
    </div>
<a id="gotoTop" class='well well-small' href='#'>
    Top
</a>
<script src="../assets/vendor/jquery/jquery-1.8.2.min.js"></script>
<script src="../assets/vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script src="../assets/js/config.js"></script>
<script src="../assets/js/doc.js"></script>
</body>
</html>
